<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>–ö–∞—Ç–∞–ª–æ–≥ + AI</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      min-height: 100vh;
      padding: 40px 20px;
      color: #1a1a1a;
      line-height: 1.6;
    }
    
    /* –ü—Ä–µ–ª–æ–∞–¥–µ—Ä */
    #preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0190CC 0%, #0175a8 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    #preloader.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .preloader-logo {
      width: 180px;
      height: auto;
      animation: logoFadeIn 1s ease, logoPulse 2s ease infinite;
      filter: drop-shadow(0 4px 20px rgba(255, 255, 255, 0.3));
    }
    
    .preloader-spinner {
      margin-top: 30px;
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .preloader-text {
      margin-top: 20px;
      color: #fff;
      font-size: 16px;
      font-weight: 500;
      animation: textFadeIn 1.5s ease;
      text-align: center;
      max-width: 400px;
      line-height: 1.5;
    }
    
    h1 {
      font-size: 36px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 32px;
      text-align: center;
      letter-spacing: -0.5px;
      animation: fadeInDown 0.6s ease;
    }
    
    h2 {
      font-size: 20px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
    }
    
    h2::before {
      content: '';
      width: 4px;
      height: 24px;
      background: #0190CC;
      margin-right: 12px;
      border-radius: 2px;
    }
    
    .card {
      background: #fff;
      padding: 28px;
      margin-bottom: 24px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
      animation: fadeInUp 0.5s ease;
    }
    
    .card:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: #fff;
      color: #1a1a1a;
      font-family: inherit;
      transition: all 0.2s ease;
      cursor: text;
    }
    
    input[type="text"]:focus {
      outline: none;
      border-color: #0190CC;
      box-shadow: 0 0 0 3px rgba(1, 144, 204, 0.1);
    }
    
    input[type="text"]::placeholder {
      color: #9ca3af;
    }
    
    select {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      font-weight: 500;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: #fff;
      color: #1a1a1a;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }
    
    select:hover {
      border-color: #0190CC;
    }
    
    select:focus {
      outline: none;
      border-color: #0190CC;
      box-shadow: 0 0 0 3px rgba(1, 144, 204, 0.1);
    }
    
    /* –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ */
    .custom-select-wrapper {
      position: relative;
      width: 100%;
    }
    
    .custom-select {
      position: relative;
      width: 100%;
    }
    
    .select-selected {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      font-weight: 500;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: #fff;
      color: #1a1a1a;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .select-selected::after {
      content: '';
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 6px solid #0190CC;
      margin-left: 10px;
      transition: transform 0.3s ease;
    }
    
    .select-selected.active::after {
      transform: rotate(180deg);
      border-top-color: #0190CC;
    }
    
    .select-selected:hover {
      border-color: #0190CC;
    }
    
    .select-items {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: #fff;
      border: 2px solid #0190CC;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      max-height: 350px;
      overflow: hidden;
      animation: dropdownSlide 0.3s ease;
    }
    
    @keyframes dropdownSlide {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .search-in-dropdown {
      width: calc(100% - 24px) !important;
      margin: 12px 12px 8px 12px !important;
      padding: 10px 12px !important;
      border: 2px solid #e5e7eb !important;
      border-radius: 8px !important;
      font-size: 15px !important;
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 10;
    }
    
    .search-in-dropdown:focus {
      border-color: #0190CC !important;
      outline: none !important;
      box-shadow: 0 0 0 3px rgba(1, 144, 204, 0.1) !important;
    }
    
    #productList {
      max-height: 250px;
      overflow-y: auto;
      padding: 0 12px 12px 12px;
    }
    
    .product-item {
      padding: 12px;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 15px;
      margin-bottom: 4px;
    }
    
    .product-item:hover {
      background: #e0f7ff;
      color: #0190CC;
      font-weight: 500;
    }
    
    .product-item:active {
      background: #0190CC;
      color: #fff;
    }
    
    textarea {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      margin-top: 12px;
      font-family: inherit;
      resize: vertical;
      min-height: 100px;
      transition: all 0.2s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: #0190CC;
      box-shadow: 0 0 0 3px rgba(1, 144, 204, 0.1);
    }
    
    textarea::placeholder {
      color: #9ca3af;
    }
    
    button {
      padding: 14px 24px;
      margin-top: 12px;
      border: none;
      border-radius: 10px;
      background: #F02137;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(240, 33, 55, 0.3);
    }
    
    button:hover {
      background: #d01828;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(240, 33, 55, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    
    .answer {
      margin-top: 16px;
      background: linear-gradient(135deg, #e0f7ff 0%, #f0f9ff 100%);
      padding: 16px;
      border-radius: 10px;
      border: 2px solid #0190CC;
      animation: slideIn 0.4s ease;
      white-space: pre-wrap;
      line-height: 1.5;
      color: #1a1a1a;
    }
    
    .error {
      margin-top: 16px;
      background: linear-gradient(135deg, #ffe5e5 0%, #fff0f0 100%);
      padding: 16px;
      border-radius: 10px;
      border: 2px solid #F02137;
      color: #c81e1e;
      font-weight: 500;
      animation: shake 0.5s ease;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥—É–∫—Ç–µ */
    .product-image {
      width: 100%;
      max-width: 300px;
      height: auto;
      margin-bottom: 24px;
      animation: fadeIn 0.5s ease;
      display: block;
      margin-left: auto;
      margin-right: auto;
      background: transparent;
    }
    
    .price-btn {
      display: inline-flex;
      align-items: center;
      padding: 12px 20px;
      background: #0190CC;
      color: #fff;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(1, 144, 204, 0.3);
      margin-bottom: 24px;
    }
    
    .price-btn:hover {
      background: #0175a8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(1, 144, 204, 0.4);
    }
    
    .price-btn::before {
      content: 'üí∞';
      margin-right: 8px;
      font-size: 18px;
    }
    
    #info .info-item {
      margin-bottom: 12px;
      animation: fadeIn 0.3s ease;
    }
    
    #info .info-item:last-child {
      margin-bottom: 0;
    }
    
    #info .info-label {
      color: #0190CC;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
    }
    
    #info .info-label::before {
      content: '';
      width: 3px;
      height: 14px;
      background: #0190CC;
      margin-right: 8px;
      border-radius: 2px;
    }
    
    #info .info-value {
      font-size: 16px;
      color: #374151;
      line-height: 1.5;
      padding-left: 11px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    #info .info-value strong,
    #info .info-value b {
      color: #0190CC;
      font-weight: 700;
    }
    
    #info .info-value em,
    #info .info-value i {
      font-style: italic;
      color: #555;
    }
    
    #info .info-value ul,
    #info .info-value ol {
      margin: 4px 0;
      padding-left: 20px;
    }
    
    #info .info-value li {
      margin-bottom: 2px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ */
    #history p {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #f3f4f6;
      animation: fadeIn 0.3s ease;
      white-space: pre-wrap;
      word-wrap: break-word;
      line-height: 1.5;
    }
    
    #history p:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    #history b {
      color: #0190CC;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
      margin-bottom: 4px;
    }
    
    #history strong {
      color: #0190CC;
      font-weight: 700;
    }
    
    #history em,
    #history i {
      font-style: italic;
      color: #555;
    }
    
    #history ul,
    #history ol {
      margin: 4px 0;
      padding-left: 20px;
    }
    
    #history li {
      margin-bottom: 2px;
    }
    
    .answer strong,
    .answer b {
      color: #0175a8;
      font-weight: 700;
    }
    
    .answer em,
    .answer i {
      font-style: italic;
      color: #555;
    }
    
    .answer ul,
    .answer ol {
      margin: 4px 0;
      padding-left: 20px;
    }
    
    .answer li {
      margin-bottom: 2px;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes logoFadeIn {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes logoPulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    @keyframes textFadeIn {
      0% {
        opacity: 0;
      }
      50% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .container {
      max-width: 900px;
      margin: 0 auto;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    
    .container.loaded {
      opacity: 1;
    }
    
    /* –°–µ—Ç–∫–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ AI */
    .grid {
      display: block;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 768px) {
      body {
        padding: 16px;
        font-size: 16px;
      }
      
      h1 {
        font-size: 26px;
        margin-bottom: 20px;
      }
      
      h2 {
        font-size: 20px;
      }
      
      h2::before {
        width: 3px;
        height: 20px;
      }
      
      .card {
        padding: 20px;
        margin-bottom: 16px;
        border-radius: 12px;
      }
      
      .container {
        max-width: 100%;
      }
      
      input[type="text"], select {
        padding: 16px;
        font-size: 16px;
      }
      
      textarea {
        padding: 16px;
        font-size: 16px;
        min-height: 120px;
      }
      
      button {
        padding: 16px;
        font-size: 16px;
      }
      
      label {
        font-size: 14px;
        margin-bottom: 10px;
      }
      
      .product-image {
        max-width: 100%;
      }
      
      .info-label {
        font-size: 13px;
      }
      
      .info-value {
        font-size: 16px;
      }
      
      .preloader-logo {
        width: 150px;
      }
    }
    
    /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 375px) {
      body {
        padding: 12px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      .card {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
  <div id="preloader">
    <img src="https://vegapharm.tj/wp-content/uploads//2024/11/logo-1.svg" alt="VegaPharm Logo" class="preloader-logo">
    <div class="preloader-spinner"></div>
    <div class="preloader-text">–Ø –∏—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –í–∞—à–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö,<br>–ø–æ–¥–æ–∂–¥–∏—Ç–µ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥...</div>
  </div>

  <div class="container">
    <h1>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ</h1>
    
    <div class="card">
      <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç:</label>
      <div class="custom-select-wrapper">
        <div class="custom-select" id="customSelect">
          <div class="select-selected">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç...</div>
          <div class="select-items" id="selectItems" style="display: none;">
            <input type="text" id="searchProduct" placeholder="üîç –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞..." class="search-in-dropdown">
            <div id="productList"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ</h2>
        <div id="info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
      </div>

      <div class="card">
        <h2>–°–ø—Ä–æ—Å–∏—Ç—å —É –ò–ò</h2>
        <textarea id="question" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..."></textarea>
        <button id="askBtn">–°–ø—Ä–æ—Å–∏—Ç—å</button>
        <div id="aiAnswer" class="answer" style="display:none;"></div>
        <div id="errorBox" class="error" style="display:none;"></div>
      </div>
    </div>

    <div class="card">
      <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
      <div id="history">–ü—É—Å—Ç–æ</div>
    </div>
  </div>

<script>
  const APP_URL = "https://script.google.com/macros/s/AKfycbxoHuYFTBkbD2Trbg62E_bwNnJpgZzUbqBdhPVclwG1M_xC_LYPNg-rsaj56VZNm3A-/exec";

  async function apiGet(path){
    try{
      const res = await fetch(APP_URL+path);
      if(!res.ok) throw new Error("HTTP "+res.status);
      return await res.json();
    }catch(e){ return {ok:false,error:e.message}; }
  }

  // –í–ù–ò–ú–ê–ù–ò–ï: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ x-www-form-urlencoded, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ CORS preflight
  async function apiPostForm(data){
    try{
      const form = new URLSearchParams();
      Object.entries(data).forEach(([k,v])=> form.append(k, v));
      const res = await fetch(APP_URL, {
        method: "POST",
        body: form  // –±–µ–∑ headers: –±—Ä–∞—É–∑–µ—Ä —Å–∞–º –ø–æ—Å—Ç–∞–≤–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Content-Type
      });
      if(!res.ok) throw new Error("HTTP "+res.status);
      return await res.json();
    }catch(e){ return {ok:false,error:e.message}; }
  }

  const customSelect=document.getElementById('customSelect');
  const selectSelected=document.querySelector('.select-selected');
  const selectItems=document.getElementById('selectItems');
  const searchInput=document.getElementById('searchProduct');
  const productList=document.getElementById('productList');
  const infoBox=document.getElementById('info');
  const aiAns=document.getElementById('aiAnswer');
  const errBox=document.getElementById('errorBox');
  const askBtn=document.getElementById('askBtn');
  const qEl=document.getElementById('question');
  const histBox=document.getElementById('history');
  
  let allProducts = []; // –•—Ä–∞–Ω–∏—Ç –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã
  let currentProduct = ''; // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç

  function showError(msg){ errBox.style.display="block"; errBox.textContent=msg; }
  function clearError(){ errBox.style.display="none"; errBox.textContent=""; }

  async function loadProducts(){
    const js = await apiGet("?action=products");
    if(!js.ok){ showError(js.error); return; }
    allProducts = js.data || [];
    updateProductList(allProducts);
    if(allProducts.length){
      currentProduct = allProducts[0];
      selectSelected.textContent = allProducts[0];
      await onProductChange(); // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–µ—Ä–≤–æ–º –ø—Ä–æ–¥—É–∫—Ç–µ
    }
  }
  
  function updateProductList(products){
    productList.innerHTML = "";
    products.forEach(p=>{
      const div=document.createElement('div');
      div.className='product-item';
      div.textContent=p;
      div.addEventListener('click', function(){
        currentProduct = p;
        selectSelected.textContent = p;
        selectItems.style.display = 'none';
        selectSelected.classList.remove('active');
        searchInput.value = '';
        updateProductList(allProducts);
        onProductChange();
      });
      productList.appendChild(div);
    });
  }
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
  selectSelected.addEventListener('click', function(e){
    e.stopPropagation();
    const isOpen = selectItems.style.display === 'block';
    if(isOpen){
      selectItems.style.display = 'none';
      selectSelected.classList.remove('active');
    } else {
      selectItems.style.display = 'block';
      selectSelected.classList.add('active');
      setTimeout(() => searchInput.focus(), 100);
    }
  });
  
  // –ü–æ–∏—Å–∫ –≤–Ω—É—Ç—Ä–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
  searchInput.addEventListener('input', function(e){
    e.stopPropagation();
    const searchTerm = this.value.toLowerCase().trim();
    if(searchTerm === ''){
      updateProductList(allProducts);
    } else {
      const filtered = allProducts.filter(p => 
        p.toLowerCase().includes(searchTerm)
      );
      updateProductList(filtered);
    }
  });
  
  // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–∏—Å–∫
  searchInput.addEventListener('click', function(e){
    e.stopPropagation();
  });
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ —Å–ø–∏—Å–∫–∞
  document.addEventListener('click', function(e){
    if(!customSelect.contains(e.target)){
      selectItems.style.display = 'none';
      selectSelected.classList.remove('active');
      searchInput.value = '';
      updateProductList(allProducts);
    }
  });

  async function onProductChange(){
    clearError();
    if(!currentProduct) return;
    const name = currentProduct;
    const [info, hist] = await Promise.all([
      apiGet(`?action=product&name=${encodeURIComponent(name)}`),
      apiGet(`?action=history&name=${encodeURIComponent(name)}`)
    ]);

    if(info.ok){
      infoBox.innerHTML="";
      const obj=info.data||{};
      if(Object.keys(obj).length===0) infoBox.textContent="–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥—É–∫—Ç–µ";
      else {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ç–æ (–ø–æ–ª—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º https://)
        Object.entries(obj).forEach(([k,v])=>{
          const value = String(v || '').trim();
          
          // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å https:// - —ç—Ç–æ —Ñ–æ—Ç–æ
          if(value.startsWith('https://')) {
            const img = document.createElement('img');
            img.src = value;
            img.alt = k;
            img.className = 'product-image';
            img.onerror = function() { 
              this.style.display = 'none'; 
            };
            infoBox.appendChild(img);
          }
        });
        
        // –ü–æ—Ç–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–µ https://)
        Object.entries(obj).forEach(([k,v])=>{
          const value = String(v || '').trim();
          
          // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—è —Å https:// (–æ–Ω–∏ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –∫–∞–∫ —Ñ–æ—Ç–æ)
          if(!value.startsWith('https://')) {
            const item = document.createElement('div');
            item.className = 'info-item';
            
            const label = document.createElement('div');
            label.className = 'info-label';
            label.textContent = k;
            
            const valueDiv = document.createElement('div');
            valueDiv.className = 'info-value';
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            valueDiv.innerHTML = value.replace(/\n/g, '<br>');
            
            item.appendChild(label);
            item.appendChild(valueDiv);
            infoBox.appendChild(item);
          }
        });
      }
    } else showError(info.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏");

    if(hist.ok){
      histBox.innerHTML="";
      const items=hist.data||[];
      if(items.length===0) histBox.textContent="–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞";
      else items.forEach(h=>{
        const p = document.createElement('p');
        const questionText = String(h.question || '').replace(/\n/g, '<br>');
        const answerText = String(h.answer || '').replace(/\n/g, '<br>');
        p.innerHTML = `<b>–í–æ–ø—Ä–æ—Å:</b> ${questionText}<br><b>–û—Ç–≤–µ—Ç:</b> ${answerText}`;
        histBox.appendChild(p);
      });
    } else showError(hist.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏");

    aiAns.style.display="none";
  }

  askBtn.addEventListener('click', async ()=>{
    clearError();
    const name = currentProduct;
    const question = qEl.value.trim();
    if(!name || !question){ showError("–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç –∏ –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å"); return; }
    askBtn.disabled = true; askBtn.textContent = "–û–±—Ä–∞–±–æ—Ç–∫–∞...";
    const js = await apiPostForm({ action:"ask", name, question });
    askBtn.disabled = false; askBtn.textContent = "–°–ø—Ä–æ—Å–∏—Ç—å";
    if(!js.ok){ showError(js.error || "–û—à–∏–±–∫–∞ AI"); return; }
    aiAns.style.display = "block";
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    aiAns.innerHTML = String(js.answer || '').replace(/\n/g, '<br>');
    onProductChange(); // –æ–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
  });
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞ –∏ –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  function hidePreloader() {
    const preloader = document.getElementById('preloader');
    const container = document.querySelector('.container');
    
    if(preloader) {
      preloader.classList.add('hidden');
      // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –∏–∑ DOM –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => {
        preloader.remove();
      }, 500);
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
    if(container) {
      setTimeout(() => {
        container.classList.add('loaded');
      }, 300);
    }
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
  async function initApp() {
    await loadProducts();
    // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    hidePreloader();
  }
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
  initApp();
</script>
</body>
</html>
